<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Slidev Workspace - Page Not Found</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .container {
        text-align: center;
        padding: 2rem;
        max-width: 500px;
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .message {
        color: #666;
        margin-bottom: 1rem;
      }
      .redirect-info {
        color: #888;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="spinner"></div>
      <div class="message">Redirecting...</div>
      <div class="redirect-info">Finding the right page for you</div>
    </div>

    <script>
      (function () {
        // Get current path and normalize it
        const currentPath = window.location.pathname;
        const pathSegments = currentPath
          .split("/")
          .filter((segment) => segment.length > 0);

        // Function to get base URL
        function getBaseUrl() {
          const base = document.querySelector("base");
          if (base) {
            return base.href;
          }
          return `${window.location.origin}/`;
        }

        // Conservative redirect logic - only redirect if path is clearly invalid
        async function handleRedirect() {
          // If no path segments, redirect to root
          if (pathSegments.length === 0) {
            window.location.replace(getBaseUrl());
            return;
          }

          // For paths like /slidev-starter-1/2, preserve the URL structure
          // Only redirect if we can confirm the base project doesn't exist
          const potentialProject = pathSegments[0];
          
          try {
            // Check if the project index exists
            const testUrl = `/${potentialProject}/index.html`;
            const response = await fetch(testUrl, { method: "HEAD" });
            
            // If project exists, try to navigate to the original URL first
            if (response.ok) {
              // Don't redirect - let the Slidev app handle the routing
              console.log(`Project ${potentialProject} exists, preserving URL: ${currentPath}`);
              // Try to load the original URL by refreshing
              window.location.reload();
              return;
            }
          } catch (error) {
            console.log("Error checking project existence:", error);
          }

          // Only redirect to root if we're sure the project doesn't exist
          console.log(`No valid project found for ${potentialProject}, redirecting to root`);
          window.location.replace(getBaseUrl());
        }

        // Add timeout fallback
        const timeoutId = setTimeout(() => {
          console.log("Redirect timeout, preserving current URL");
          // Don't redirect on timeout, let the URL stay as-is
          document.querySelector('.message').textContent = 'Page not found';
          document.querySelector('.redirect-info').textContent = 'The requested page could not be found';
          document.querySelector('.spinner').style.display = 'none';
        }, 3000);

        // Execute redirect logic
        handleRedirect()
          .catch((error) => {
            console.error("Redirect error:", error);
            clearTimeout(timeoutId);
            // On error, don't force redirect - preserve URL
            document.querySelector('.message').textContent = 'Page not found';
            document.querySelector('.redirect-info').textContent = 'The requested page could not be found';
            document.querySelector('.spinner').style.display = 'none';
          })
          .finally(() => {
            clearTimeout(timeoutId);
          });
      })();
    </script>
  </body>
</html>
